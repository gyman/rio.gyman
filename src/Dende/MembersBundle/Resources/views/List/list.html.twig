{% extends "base.html.twig" %}

{% block body_class %}membersList{% endblock %}

{% block body %}
<div class="heading">
    <h3>Członkowie klubu</h3>                    
    <a href="{{path("_member_new")}}" class="btn pull-right createNewMember"><span class="icon32 icomoon-icon-new green"></span>Nowa osoba</a>
</div><!-- End .heading-->

<!-- Build page from here: Usual with <div class="row-fluid"></div> -->


<div class="row-fluid">

    <div class="span12">

        <div class="box gradient">

            <div class="title">
                <div class="pull-right" id="chooseMembersListForm">
                    <a class="icomoon-icon-list green pull-left"  href="{{ path("_members_list") }}"></a>
                    <a class="icomoon-icon-grid green pull-left" href="{{ path("_members_gallery") }}"></a>
                </div>
                
                {# TODO unlock for filter
                <button id="filterModalButton" data-target="#filterModal" role="button" data-toggle="modal" class="btn btn-link pull-left">
                    <span class="icon16 icomoon-icon-cog-2"></span><span class="caret"></span>
                </button>
                #}
                <h4>
                    <span>{% block membersTitle %}Lista osób{% endblock membersTitle %}</span>
                </h4>
            </div>
            <div class="content noPad clearfix">
                {% block membersBody %}
                <table cellpadding="0" cellspacing="0" border="0" class="dynamicTable display table table-bordered" width="100%" id="membersList">
                    <thead>
                        <tr>
                            <th class="beltColor"></th>
                            <th>Imię i nazwisko</th>
                            {# <th>Ost. wizyta</th> #}
                            <th>Karnet</th>
                            <th>Akcje</th>
                        </tr>
                    </thead>
                    <tbody>
        {% for member in members %}
                        <tr>
                            <td class="beltColor {% if member.getBelt() %}belt-{{ member.getBelt() }}{% endif %}">
                            {# TODO: funny and ugly, gtfo with this :D #}
                                <span class="hidden">
                                {% if member.getBelt() == 'blue' %}
                                2
                                {% elseif member.getBelt() == 'purple' %}
                                3
                                {% elseif member.getBelt() == 'brown' %}
                                4
                                {% elseif member.getBelt() == 'black' %}
                                5
                                {% else %}
                                1
                                {% endif %}
                                </span>
                                
                            </td>
                            <td class="profileColumn">
                                <div class="clearfix">
                                    <a class="avatar name editMember" href="{{ path("_member_edit", {"id" : member.id}) }}">
                                        <img src="{{ member.getFoto() }}" class=""/>
                                    </a>

                                    <a class="name editMember" href="{{ path("_member_edit", {"id" : member.id}) }}"><strong>{{ member.name }}</strong></a>
                                    <div class="action">
                                        <a class="btn btn-mini editMember" href="{{ path("_member_edit", {"id" : member.id}) }}"><span class="icomoon-icon-pencil-2"></span> Profil</a>
                                    </div>
                                    <a class="email" href="mailto:{{ member.getEmail() }}">{{ member.getEmail() }}</a>
                                </div>
                            </td>
                            {#
                            <td>
                                {% if member.getLastEntry is not null %}
                                <div class="label">{{ member.getLastEntry().getActivity().getName()}} </div>
                                <div class="badge badge-info">{{ member.getLastEntry().getEntryDate()|date("d.m.Y H:i") }}</div>
                                {% endif %}
                            </td>
                        #}
                            <td class="voucherColumn">
                                {{ render(controller('MembersBundle:List:currentVoucher', { 'id': member.getId() })) }}
                            </td>
                            <td>
                                <div class="btn-group">
                                    {# <a class="btn editMember" href="{{ path("_member_edit", {"id" : member.id}) }}"><span class="icomoon-icon-pencil-2"></span> Pokaż</a> #}
                                    <a href="{{ path("_voucher_new", {"id" : member.id})}}" class="btn btn-mini newVoucher"><span class="icomoon-icon-clock"></span> Karnet</a>
                                    <a class="btn btn-mini addEntrance" href="{{ path("_entrance_add", {"id" : member.id}) }}"><span class="icomoon-icon-signup "></span> Wejście</a>

                                    {#
                                    <a class="btn dropdown-toggle" data-toggle="dropdown" href="#"><span class="icon-align-left"></span> Sprzedaż<span class="caret"></span></a>
                                    <ul class="dropdown-menu pull-right">
                                      <li><a href="{{ path("_voucher_new", {"id" : member.id})}}" class="newVoucher"><span class="icomoon-icon-clock"></span> Karnet</a></li>
                                      <li><a href="#"><span class="icomoon-icon-cart-3"></span> Towar</a></li>
                                    </ul> #}
                                </div>
                            </td>
                        </tr>
        {% endfor %}
                    </tbody>
                </table>
                {% endblock membersBody %}
            </div>

        </div><!-- End .box -->

    </div><!-- End .span12 -->

</div><!-- End .row-fluid -->

{% include 'MembersBundle::_filterModal.html.twig' %}
{% include 'MembersBundle::_memberModal.html.twig' %}
{% include 'MembersBundle::_voucherModal.html.twig' %}
{% include 'MembersBundle::_entranceModal.html.twig' %}

{% endblock body %}

{# javascripts #}

{% block javascripts %}
    {{ parent() }}

    {% javascripts
        '@LayoutBundle/Resources/public/plugins/tables/dataTables/jquery.dataTables.js'
        '@LayoutBundle/Resources/public/plugins/forms/select2/select2.min.js'
        '@MembersBundle/Resources/public/coffee/members.list.coffee'
        '@DefaultBundle/Resources/public/js/jquery.ui.widget.js'
        '@DefaultBundle/Resources/public/js/jquery.iframe-transport.js'
        '@DefaultBundle/Resources/public/js/jquery.fileupload.js'
        '@DefaultBundle/Resources/public/js/jquery.ui.spinner.js'
     %}

<script src="{{ asset_url }}"></script>

    {% endjavascripts %}
{% endblock javascripts %}

{# CSS #}

{% block stylesheets %}
    {{ parent() }}

    {% stylesheets filter='cssrewrite'
        'bundles/layout/plugins/tables/dataTables/jquery.dataTables.css'
        'bundles/layout/plugins/forms/select2/select2.css'
        'bundles/layout/plugins/forms/select2/select2-bootstrap.css'
        '@MembersBundle/Resources/public/less/members-list.less'
        filter="cssrewrite"
    %}

<link rel="stylesheet" href="{{ asset_url }}" />

    {% endstylesheets %}
{% endblock stylesheets %}